<div class="container mt-5">
  <div class="card border-1">
    <div class="card-body">
      <form #enrolementForm="ngForm" (ngSubmit)="onSubmit(enrolementForm)" novalidate>
        <div class="row g-3">
          <!-- Student Dropdown -->
          <div class="col-md-12">
            <div class="floating">
              <select name="studentId" class="form-select" [(ngModel)]="enrolement.detailsDto.studentId"
                #studentId="ngModel" (focus)="isStudentFocused = true" (blur)="isStudentFocused = false"
                [ngClass]="{ 'active': enrolement.detailsDto.studentId || isStudentFocused }" required>
                <option *ngFor="let s of enrolement.users" [value]="s.id">
                  {{ s.name }}
                </option>
              </select>
              <label>Student *</label>
            </div>
            <div class="text-danger small" *ngIf="studentId.invalid && studentId.touched">
              Student is required
            </div>
          </div>

          <!-- Enrollment Date -->
          <div class="col-md-12">
            <div class="floating">
              <input type="date" name="enrolledDate" class="form-control"
                [(ngModel)]="enrolement.detailsDto.enrolledDate" #enrolledDate="ngModel" (focus)="isDateFocused = true"
                (blur)="isDateFocused = false"
                [ngClass]="{ 'active': enrolement.detailsDto.enrolledDate || isDateFocused }" required />
              <label>Enrollment Date *</label>
            </div>
            <div class="text-danger small" *ngIf="enrolledDate.invalid && enrolledDate.touched">
              Enrollment date is required
            </div>
          </div>

          <!-- Is TA -->
          <div class="col-md-12">
            <div class="form-check mt-2">
              <input class="form-check-input" type="checkbox" name="isTa" [(ngModel)]="enrolement.detailsDto.isTa"
                id="isTa" />
              <label class="form-check-label" for="isTa">
                Teaching Assistant
              </label>
            </div>
          </div>

          <div *ngIf="enrolement.detailsDto.isTa" class="mt-4 ta-lab-hours-section" >

            <h5 class="mb-3">TA Lab Hours (Max 10 hours per week)</h5>

            <div class="border rounded p-3 mb-3" *ngFor="let h of taLabHours; let i = index">
              <div class="row g-2 align-items-end">

                <div class="col-md-3">
                  <label class="form-label">Day</label>
                  <select class="form-select" [(ngModel)]="h.dayOfWeek" name="day{{i}}" required>
                    <option [ngValue]="null">Select</option>
                    <option *ngFor="let d of [0,1,2,3,4,5,6]" [ngValue]="d">
                      {{ ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][d] }}
                    </option>
                  </select>
                </div>

                <div class="col-md-2">
                  <label class="form-label">Start</label>
                  <input type="time" class="form-control" [(ngModel)]="h.startTime" name="start{{i}}" required />
                </div>

                <div class="col-md-2">
                  <label class="form-label">End</label>
                  <input type="time" class="form-control" [(ngModel)]="h.endTime" name="end{{i}}" required />
                </div>

                <div class="col-md-2">
                  <label class="form-label">Mode</label>
                  <select class="form-select" [(ngModel)]="h.mode" name="mode{{i}}" required>
                    <option [ngValue]="null">Select</option>
                    <option [ngValue]="1">In Person</option>
                    <option [ngValue]="2">Remote</option>
                    <option [ngValue]="3">Hybrid</option>
                  </select>
                </div>

                <div class="col-md-2" *ngIf="h.mode === 2 || h.mode === 3">
                  <label class="form-label">Remote Link</label>
                  <input type="text" class="form-control" [(ngModel)]="h.remoteLink" name="link{{i}}" />
                </div>

                <div class="col-md-1 text-end">
                  <button type="button" class="btn btn-outline-danger" (click)="removeLabHour(i)"
                    *ngIf="taLabHours.length > 1">
                    Ã—
                  </button>
                </div>

              </div>
            </div>

            <div class="d-flex justify-content-between align-items-center">
              <button type="button" class="btn btn-outline-primary" (click)="addLabHour()">
                Add Lab Hour
              </button>

              <div class="fw-semibold" [class.text-danger]="getTotalWeeklyHours() > maxWeeklyHours">
                Total Weekly Hours: {{ getTotalWeeklyHours() | number:'1.1-1' }} / 10
              </div>
            </div>

            <div class="text-danger mt-2" *ngIf="getTotalWeeklyHours() > maxWeeklyHours">
              Total TA lab hours cannot exceed 10 hours per week.
            </div>

          </div>


        </div>

        <div class="mt-4 d-flex justify-content-end">
          <button type="button" class="btn btn-secondary me-2" (click)="onCancel()">
            Cancel
          </button>

          <button type="submit" class="btn btn-primary">
            {{
            enrolement.detailsDto.id !== EMPTY_ID
            ? 'Update Enrolement'
            : 'Create Enrolement'
            }}
          </button>
        </div>

      </form>
    </div>
  </div>
</div>